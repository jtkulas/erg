---
title: 
author: ''
date: '2021-06-11'
slug: Testing
categories: []
tags: [MSRA]
bibliography: packages.bib
---

<p align="center">
[![](scvc.PNG)](http://www.stcroixvalleycorvettes.com/)
</p>

# Ethanol-free petrol map 

```{r, echo=FALSE, warning=FALSE, include=FALSE}
library(leaflet)
oct <- read.csv("octane.csv")

# oct$octane <- as.factor(as.character(oct$octane))

pal2 <- colorNumeric(
  palette = "Spectral",
  reverse = TRUE,
  domain = oct$octane
)

## create leaflet map
octmap <- leaflet() %>% 
  addProviderTiles("CartoDB.Positron") %>% 
  setView(-93.11389168, 45.08506268	,
          zoom = 8) %>%
  addTiles() %>%
  addCircles(data=oct, lng = ~long, lat = ~lat, popup = ~address, weight=10, color=~pal2(octane), opacity=1, radius=10) %>%
  addLegend("bottomright", data=oct, pal = pal2, values = ~octane)

widgetframe::frameWidget(octmap) ## trying for online

```


```{r echo=FALSE, warning=FALSE, include=FALSE}

oct$color[oct$octane == 91] <- "orange"
oct$color[oct$octane == 93] <- "lightred"
oct$color[oct$octane == 95] <- "darkred"

icons <- awesomeIcons(icon = "fire",
                      iconColor = "#000000",
                      markerColor = oct$color)

octmap2 <- leaflet() %>%
  addProviderTiles("CartoDB.Positron") %>% 
  setView(-93.11389168, 45.08506268	,
          zoom = 8) %>%
  addTiles() %>%
  addAwesomeMarkers(data = oct, lng = ~long, lat = ~lat, icon = icons) 

widgetframe::frameWidget(octmap2) ## trying for online

```


```{r echo=FALSE, warning=FALSE}
knitr::write_bib(c(.packages(), "bookdown", "tidygeocoder"), "packages.bib")

minny <- read.csv("minny.csv")
iowa <- read.csv("iowa.csv")
sd <- read.csv("sd.csv")
wisc <- read.csv("wisc.csv")
nd <- read.csv("nd.csv")

miss <- read.csv("missing_geocodio.csv")  ## taken from geocodio
use <- miss[,c(1:11)]
colnames(use)[10] <- "lat"
colnames(use)[11] <- "long"

use$lat[use$lat == 0] <- NA
use$long[use$long == 0] <- NA

states <- rbind(minny, iowa, sd, wisc, nd, use)


library(stringr)
states$max <- as.numeric(str_sub(states$Octane, start= -3))

missing <- states[ which(is.na(states$lat) & is.na(states$long)), ]
missing <- missing[,2:9]

# write.csv(missing, "missing.csv")  ## for 3rd party lat and long estimates

```

The map below contains information from `r (nrow(states) - nrow(missing))` stations in MN, WI, SD, ND, and IA indicating that they offer ethanol-free gas. The map data was taken from [pure-gas.org](https://www.pure-gas.org/), but also relies on latitude and longitude *estimates* generated from physical addresses via the `r icons::fontawesome("r-project")` [@R-base] package `tidygeocoder` [@R-tidygeocoder] version `r packageVersion("tidygeocoder")` as well as [geocodio](https://www.geocod.io/). The "visual dots" are only to be referenced as general vicinity indicators. The physical addresses, however, should be considered to be accurate as per [pure-gas.org](https://www.pure-gas.org/):

<p align="center">
`r emo::ji("warning")` `r emo::ji("warning")` `r emo::ji("skull_and_crossbones")` **NEVER** use this map *while driving* `r emo::ji("face_with_symbols_on_mouth")` `r emo::ji("warning")` `r emo::ji("warning")` 
</p>

```{r map, echo=FALSE, warning=FALSE, include=FALSE}

pal <- colorNumeric(
  palette = "Spectral",
  reverse = TRUE,
  domain = states$max
)

puregas <- leaflet() %>% 
  addProviderTiles("CartoDB.Positron") %>% 
  setView(-93.11389168, 45.08506268	,
          zoom = 6) %>%
  addTiles() %>%
  addCircles(data=states, lng = ~long, lat = ~lat, popup = ~paste(Name, "<br>",Street.Address, "<br>", City, State, "<br>", Phone, "<br>", "Max Octane:", max), color=~pal(max), opacity=.8) %>%
  addLegend("bottomright", data=states, pal = pal, values = ~max)

widgetframe::frameWidget(puregas) ## trying for online

```


```{r map2, echo=FALSE, warning=FALSE}

states$octane[states$max < 91] <- "less than 91"
states$octane[states$max == 91] <- "91"
states$octane[states$max > 91 & states$max < 100] <- "92 - 99"
states$octane[states$max > 99] <- "100 or more"

states$octane <- factor(states$octane, levels = c("less than 91", "91", "92 - 99", "100 or more"))

states$mapping <- as.numeric(as.character(str_sub(states$Octane, start= -1)))  ## for circle radius

pal2 <- colorFactor(
  palette = c("#0000FF", "#FFFF00", "#FF0000", "#FF00CC"),
  domain = states$octane
)

## create leaflet map
altmap <- leaflet() %>% 
  addProviderTiles("CartoDB.Positron") %>% 
  setView(-93.11389168, 45.08506268	,
          zoom = 9) %>%
  addTiles() %>%
  addCircles(data=states, lng = ~long, lat = ~lat, weight = 1,
             radius = ~max*10, popup = ~paste(Name, "<br>",Street.Address, "<br>", City, State, "<br>", Phone, "<br>", "Max Octane:", max), fillColor=~pal2(octane), fillOpacity = .5 ) %>%
  addLegend("bottomright", data=states, pal = pal2, values = ~octane, opacity = 1)

widgetframe::frameWidget(altmap)

```

The 5-state [pure-gas.org](https://www.pure-gas.org/) database of stations is also searchable via the following table[^oops]:

[^oops]: Depreciated phone functionality 7/8/21 due to conflict with computer browser functionality (table was prettier but not expandable; e.g., the table will be useful on a computer but **not** on a  phone from this point forward).

```{r missingstations, warning=FALSE, echo=FALSE}

table <- states[ which(!is.na(states$lat) & !is.na(states$long)), ]

library(DT)
datatable(table[c(5,7,2,9,4,6)], rownames=FALSE, options = list(pageLength = 5))  

```

